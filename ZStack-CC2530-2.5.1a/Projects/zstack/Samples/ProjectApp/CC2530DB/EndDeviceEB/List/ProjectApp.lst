###############################################################################
#
# IAR C/C++ Compiler V10.30.1.6000 for 8051               27/Jul/2019  11:10:03
# Copyright 2004-2018 IAR Systems AB.
# PC-locked license - IAR Embedded Workbench for 8051
#
#    Core               =  plain
#    Code model         =  banked
#    Data model         =  large
#    Calling convention =  xdata reentrant
#    Constant location  =  data_rom
#    Dptr setup         =  1,16
#                          
#    Source file        =  
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\Source\ProjectApp.c
#    Command line       =  
#        -f C:\Users\Admin\AppData\Local\Temp\EWCF30.tmp
#        (E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\Source\ProjectApp.c
#        -D NWK_AUTO_POLL -D ZTOOL_P1 -D xMT_TASK -D xMT_SYS_FUNC -D
#        xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG -D HAL_LCD=FALSE -D xPOWER_SAVING
#        -lC
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\EndDeviceEB\List
#        -lA
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\EndDeviceEB\List
#        --diag_suppress Pe001,Pa010 -o
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\EndDeviceEB\Obj
#        -e --debug --core=plain --dptr=16,1 --data_model=large
#        --code_model=banked --calling_convention=xdata_reentrant
#        --place_constants=data_rom --nr_virtual_regs 8 -f
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg
#        (-DCPU32MHZ -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3
#        -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg
#        (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR
#        -DDEFAULT_CHANLIST=0x00000800 -DZDAPP_CONFIG_PAN_ID=0xFFFF
#        -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MASK=0x007F
#        -DBEACON_REQUEST_DELAY=100 -DBEACON_REQ_DELAY_MASK=0x00FF
#        -DLINK_STATUS_JITTER_MASK=0x007F -DROUTE_EXPIRY_TIME=30
#        -DAPSC_ACK_WAIT_DURATION_POLLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7
#        -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3
#        -DNWK_MAX_DATA_RETRIES=2 -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9
#        -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40 -DNWK_MAX_BINDING_ENTRIES=4
#        -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01, 0x03, 0x05, 0x07,
#        0x09, 0x0B, 0x0D, 0x0F, 0x00, 0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C,
#        0x0D}" -DMAC_MAX_FRAME_SIZE=116 -DZDNWKMGR_MIN_TRANSMISSIONS=20
#        "-DCONST=const __code" -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE
#        -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100
#        -DREJOIN_POLL_RATE=440) -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\Source\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\ZMain\TI2530DB\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\hal\include\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\hal\target\CC2530EB\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\mac\include\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\mac\high_level\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\mac\low_level\srf04\single_chip\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\mt\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\osal\include\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\services\saddr\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\services\sdata\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\stack\af\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\stack\nwk\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\stack\sapi\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\stack\sec\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\stack\sys\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\stack\zdo\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\zmac\
#        -I
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\..\..\..\..\..\Components\zmac\f8w\
#        -Ohz --require_prototypes --no_code_motion)
#    Locale             =  Chinese (Simplified)_CHN.936
#    List file          =  
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\EndDeviceEB\List\ProjectApp.lst
#    Object file        =  
#        E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\CC2530DB\EndDeviceEB\Obj\ProjectApp.r51
#
###############################################################################

E:\GitHub\DHT11-end-device\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ProjectApp\Source\ProjectApp.c
      1          #include "OSAL.h"
      2          #include "AF.h"
      3          #include "ZDApp.h"
      4          #include "ZDObject.h"
      5          #include "ZDProfile.h"
      6          
      7          #include "stdio.h"
      8          #include "string.h"
      9          #include "math.h"
     10          //#include "DHT11.h"
     11          #include "ProjectApp.h"
     12          #include "DebugTrace.h"
     13          #include "sht2x.h"
     14          
     15          #if !defined( WIN32 )
     16            #include "OnBoard.h"
     17          #endif
     18          
     19          /* HAL */
     20          #include "hal_lcd.h"
     21          #include "hal_led.h"
     22          #include "hal_key.h"
     23          #include "hal_uart.h"
     24          
     25          /* RTOS */
     26          #if defined( IAR_ARMCM3_LM )
     27          #include "RTOS_App.h"
     28          #endif  
     29          
     30          #include "user_uart0.h"
     31          #include "user_printf.h"
     32          #include "user_api.h"
     33          /*********************************************************************
     34           * MACROS
     35           */
     36          
     37          /*********************************************************************
     38           * CONSTANTS
     39           */
     40          
     41          /*********************************************************************
     42           * TYPEDEFS
     43           */
     44          
     45          /*********************************************************************
     46           * GLOBAL VARIABLES
     47           */
     48          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
     49          const cId_t ProjectApp_ClusterList[PROJECTAPP_MAX_CLUSTERS] =
   \                     ProjectApp_ClusterList:
   \   000000   0100         DW 1
     50          {
     51            PROJECTAPP_CLUSTERID
     52          };
     53          

   \                                 In  segment XDATA_ROM_C, align 1
     54          const SimpleDescriptionFormat_t ProjectApp_SimpleDesc =
   \                     ProjectApp_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW ProjectApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW ProjectApp_ClusterList
     55          {
     56            PROJECTAPP_ENDPOINT,              //  int Endpoint;
     57            PROJECTAPP_PROFID,                //  uint16 AppProfId[2];
     58            PROJECTAPP_DEVICEID,              //  uint16 AppDeviceId[2];
     59            PROJECTAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
     60            PROJECTAPP_FLAGS,                 //  int   AppFlags:4;
     61            PROJECTAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     62            (cId_t *)ProjectApp_ClusterList,  //  byte *pAppInClusterList;
     63            PROJECTAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     64            (cId_t *)ProjectApp_ClusterList   //  byte *pAppInClusterList;
     65          };
     66          
     67          // This is the Endpoint/Interface description.  It is defined here, but
     68          // filled-in in ProjectApp_Init().  Another way to go would be to fill
     69          // in the structure here and make it a "const" (in code space).  The
     70          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     71          endPointDesc_t ProjectApp_epDesc;
   \                     ProjectApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
     72          
     73          /*********************************************************************
     74           * EXTERNAL VARIABLES
     75           */
     76          
     77          /*********************************************************************
     78           * EXTERNAL FUNCTIONS
     79           */
     80          
     81          /*********************************************************************
     82           * LOCAL VARIABLES
     83           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     84          byte ProjectApp_TaskID;   // Task ID for internal task/event processing
   \                     ProjectApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     85                                    // This variable will be received when
     86                                    // ProjectApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     87          devStates_t ProjectApp_NwkState;
   \                     ProjectApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     88          
     89          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     90          byte ProjectApp_TransID;  // This is the unique message ID (counter)
   \                     ProjectApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     91          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     92          afAddrType_t ProjectApp_DstAddr;
   \                     ProjectApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
     93          
     94          /*********************************************************************
     95           * LOCAL FUNCTIONS
     96           */
     97          
     98          static void ProjectApp_HandleKeys( byte shift, byte keys );
     99          //static void ProjectApp_SendTheMessage( void );
    100          static void ProjectApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    101          static void ProjectApp_MessageMSGCB( afIncomingMSGPacket_t *pkt );
    102          #if defined( IAR_ARMCM3_LM )
    103          static void ProjectApp_ProcessRtosMessage( void );
    104          #endif
    105          static void ProjectApp_SendBindcast( void );
    106          /*********************************************************************
    107           * NETWORK LAYER CALLBACKS
    108           */
    109          
    110          /*********************************************************************
    111           * PUBLIC FUNCTIONS
    112           */
    113          
    114          /*********************************************************************
    115           * @fn      ProjectApp_Init
    116           *
    117           * @brief   Initialization function for the Project App Task.
    118           *          This is called during initialization and should contain
    119           *          any application specific initialization (ie. hardware
    120           *          initialization/setup, table initialization, power up
    121           *          notificaiton ... ).
    122           *
    123           * @param   task_id - the ID assigned by OSAL.  This ID should be
    124           *                    used to send messages and set timers.
    125           *
    126           * @return  none
    127           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    128          void ProjectApp_Init( uint8 task_id )
   \                     ProjectApp_Init:
    129          {
   \   000000   74F7         MOV       A,#-0x9
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV       A,R1
    130            ProjectApp_TaskID = task_id;
   \   000006   90....       MOV       DPTR,#ProjectApp_TaskID
   \   000009   F0           MOVX      @DPTR,A
    131            ProjectApp_NwkState = DEV_INIT;
   \   00000A   90....       MOV       DPTR,#ProjectApp_NwkState
   \   00000D   7401         MOV       A,#0x1
   \   00000F   F0           MOVX      @DPTR,A
    132            ProjectApp_TransID = 0;
   \   000010   90....       MOV       DPTR,#ProjectApp_TransID
   \   000013   E4           CLR       A
   \   000014   F0           MOVX      @DPTR,A
    133          
    134            // Device hardware initialization can be added here or in main() (Zmain.c).
    135            // If the hardware is application specific - add it here.
    136            // If the hardware is other parts of the device add it in main().
    137          
    138            ProjectApp_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   000015   90....       MOV       DPTR,#ProjectApp_DstAddr + 8
   \   000018   F0           MOVX      @DPTR,A
    139            ProjectApp_DstAddr.endPoint = 0;
   \   000019   A3           INC       DPTR
   \   00001A   F0           MOVX      @DPTR,A
    140            ProjectApp_DstAddr.addr.shortAddr = 0;
   \   00001B   90....       MOV       DPTR,#ProjectApp_DstAddr
   \   00001E   F0           MOVX      @DPTR,A
   \   00001F   A3           INC       DPTR
   \   000020   F0           MOVX      @DPTR,A
    141          
    142            // Fill out the endpoint description.
    143            ProjectApp_epDesc.endPoint = PROJECTAPP_ENDPOINT;
   \   000021   90....       MOV       DPTR,#ProjectApp_epDesc
   \   000024   740A         MOV       A,#0xa
   \   000026   F0           MOVX      @DPTR,A
    144            ProjectApp_epDesc.task_id = &ProjectApp_TaskID;
   \   000027   A3           INC       DPTR
   \   000028   74..         MOV       A,#ProjectApp_TaskID & 0xff
   \   00002A   F0           MOVX      @DPTR,A
   \   00002B   A3           INC       DPTR
   \   00002C   74..         MOV       A,#(ProjectApp_TaskID >> 8) & 0xff
   \   00002E   F0           MOVX      @DPTR,A
    145            ProjectApp_epDesc.simpleDesc
    146                      = (SimpleDescriptionFormat_t *)&ProjectApp_SimpleDesc;
   \   00002F   A3           INC       DPTR
   \   000030   74..         MOV       A,#ProjectApp_SimpleDesc & 0xff
   \   000032   F0           MOVX      @DPTR,A
   \   000033   A3           INC       DPTR
   \   000034   74..         MOV       A,#(ProjectApp_SimpleDesc >> 8) & 0xff
   \   000036   F0           MOVX      @DPTR,A
    147            ProjectApp_epDesc.latencyReq = noLatencyReqs;
   \   000037   A3           INC       DPTR
   \   000038   E4           CLR       A
   \   000039   F0           MOVX      @DPTR,A
    148          
    149            // Register the endpoint description with the AF
    150            afRegister( &ProjectApp_epDesc );
   \   00003A                ; Setup parameters for call to function afRegister
   \   00003A   7A..         MOV       R2,#ProjectApp_epDesc & 0xff
   \   00003C   7B..         MOV       R3,#(ProjectApp_epDesc >> 8) & 0xff
   \   00003E   12....       LCALL     `??afRegister::?relay`; Banked call to: afRegister
    151          
    152            // Register for all key events - This app will handle all key events
    153            RegisterForKeys( ProjectApp_TaskID );
   \   000041                ; Setup parameters for call to function RegisterForKeys
   \   000041   90....       MOV       DPTR,#ProjectApp_TaskID
   \   000044   E0           MOVX      A,@DPTR
   \   000045   F9           MOV       R1,A
   \   000046   12....       LCALL     `??RegisterForKeys::?relay`; Banked call to: RegisterForKeys
    154          
    155            // Update the display
    156          #if defined ( LCD_SUPPORTED )
    157            HalLcdWriteString( "ProjectApp", HAL_LCD_LINE_1 );
    158          #endif
    159          
    160            ZDO_RegisterForZDOMsg( ProjectApp_TaskID, End_Device_Bind_rsp );
   \   000049                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000049   12....       LCALL     ?Subroutine0 & 0xFFFF
    161            ZDO_RegisterForZDOMsg( ProjectApp_TaskID, Match_Desc_rsp );
   \                     ??CrossCallReturnLabel_0:
   \   00004C                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00004C   7A06         MOV       R2,#0x6
   \   00004E   12....       LCALL     ??Subroutine1_0 & 0xFFFF
    162          
    163          #if defined( IAR_ARMCM3_LM )
    164            // Register this task with RTOS task initiator
    165            RTOS_RegisterApp( task_id, PROJECTAPP_RTOS_MSG_EVT );
    166          #endif
    167            
    168            USER_Uart0_Init(HAL_UART_BR_115200);
   \                     ??CrossCallReturnLabel_2:
   \   000051                ; Setup parameters for call to function USER_Uart0_Init
   \   000051   7904         MOV       R1,#0x4
   \   000053   12....       LCALL     `??USER_Uart0_Init::?relay`; Banked call to: USER_Uart0_Init
    169             
    170            ZDO_RegisterForZDOMsg( ProjectApp_TaskID, End_Device_Bind_rsp );
   \   000056                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000056   12....       LCALL     ?Subroutine0 & 0xFFFF
    171          
    172            SHT2x_Init(); 
   \                     ??CrossCallReturnLabel_1:
   \   000059                ; Setup parameters for call to function SHT2x_Init
   \   000059   12....       LCALL     `??SHT2x_Init::?relay`; Banked call to: SHT2x_Init
    173          
    174          //  osal_start_timerEx( ProjectApp_TaskID,
    175          //                      PROJECTAPP_SEND_MSG_EVT,
    176          //                      PROJECTAPP_SEND_MSG_TIMEOUT );
    177          }
   \   00005C   7F01         MOV       R7,#0x1
   \   00005E   02....       LJMP      ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7A20         MOV       R2,#0x20
   \   000002                REQUIRE ??Subroutine1_0
   \   000002                ; // Fall through to label ??Subroutine1_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine1_0:
   \   000000   7B80         MOV       R3,#-0x80
   \   000002   90....       MOV       DPTR,#ProjectApp_TaskID
   \   000005   E0           MOVX      A,@DPTR
   \   000006   F9           MOV       R1,A
   \   000007   12....       LCALL     `??ZDO_RegisterForZDOMsg::?relay`; Banked call to: ZDO_RegisterForZDOMsg
   \   00000A   22           RET
    178          
    179          /*********************************************************************
    180           * @fn      ProjectApp_ProcessEvent
    181           *
    182           * @brief   Project Application Task event processor.  This function
    183           *          is called to process all events for the task.  Events
    184           *          include timers, messages and any other user defined events.
    185           *
    186           * @param   task_id  - The OSAL assigned task ID.
    187           * @param   events - events to process.  This is a bit map and can
    188           *                   contain more than one event.
    189           *
    190           * @return  none
    191           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    192          uint16 ProjectApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     ProjectApp_ProcessEvent:
    193          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000   74F0         MOV       A,#-0x10
   \   000002   12....       LCALL     ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 53
   \   000005   74CB         MOV       A,#-0x35
   \   000007   12....       LCALL     ?ALLOC_XSTACK8
   \   00000A   EA           MOV       A,R2
   \   00000B   FE           MOV       R6,A
   \   00000C   EB           MOV       A,R3
   \   00000D   FF           MOV       R7,A
    194            afIncomingMSGPacket_t *MSGpkt;
    195            afDataConfirm_t *afDataConfirm;
    196          
    197            // Data Confirmation message fields
    198            byte sentEP;
    199            ZStatus_t sentStatus;
    200            byte sentTransID;       // This should match the value sent
    201            (void)task_id;  // Intentionally unreferenced parameter
    202          
    203            if ( events & SYS_EVENT_MSG )
   \   00000E   5480         ANL       A,#0x80
   \   000010   7003         JNZ       $+5
   \   000012   02....       LJMP      ??ProjectApp_ProcessEvent_0 & 0xFFFF
    204            {
    205              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( ProjectApp_TaskID );
   \   000015                ; Setup parameters for call to function osal_msg_receive
   \   000015   800D         SJMP      ??ProjectApp_ProcessEvent_1
    206              while ( MSGpkt )
    207              {
    208                switch ( MSGpkt->hdr.event )
    209                {
    210                  case ZDO_CB_MSG:
    211                    ProjectApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    212                    break;
    213          
    214                  case KEY_CHANGE:
    215                    ProjectApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    216                    break;
    217          
    218                  case AF_DATA_CONFIRM_CMD:
    219                    // This message is received as a confirmation of a data packet sent.
    220                    // The status is of ZStatus_t type [defined in ZComDef.h]
    221                    // The message fields are defined in AF.h
    222                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    223                    sentEP = afDataConfirm->endpoint;
    224                    sentStatus = afDataConfirm->hdr.status;
    225                    sentTransID = afDataConfirm->transID;
    226                    (void)sentEP;
    227                    (void)sentTransID;
    228          
    229                    // Action taken when confirmation is received.
    230                    if ( sentStatus != ZSuccess )
    231                    {
    232                      // The data wasn't delivered -- Do something
    233                    }
    234                    break;
    235          
    236                  case AF_INCOMING_MSG_CMD:
    237                     ProjectApp_MessageMSGCB( MSGpkt );
    238                    break;
    239                    
    240                  case ZDO_STATE_CHANGE:
    241                     user_state_change((devStates_t)(MSGpkt->hdr.status));
   \                     ??ProjectApp_ProcessEvent_2:
   \   000017                ; Setup parameters for call to function user_state_change
   \   000017   A3           INC       DPTR
   \   000018   E0           MOVX      A,@DPTR
   \   000019   F9           MOV       R1,A
   \   00001A   12....       LCALL     `??user_state_change::?relay`; Banked call to: user_state_change
    242                    break;
    243          
    244                  default:
    245                    break;
    246                }
    247          
    248                // Release the memory
    249                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??ProjectApp_ProcessEvent_3:
   \   00001D                ; Setup parameters for call to function osal_msg_deallocate
   \   00001D   AA..         MOV       R2,?V0
   \   00001F   AB..         MOV       R3,?V1
   \   000021   12....       LCALL     `??osal_msg_deallocate::?relay`; Banked call to: osal_msg_deallocate
    250          
    251                // Next
    252                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( ProjectApp_TaskID );
   \   000024                ; Setup parameters for call to function osal_msg_receive
   \                     ??ProjectApp_ProcessEvent_1:
   \   000024   90....       MOV       DPTR,#ProjectApp_TaskID
   \   000027   E0           MOVX      A,@DPTR
   \   000028   F9           MOV       R1,A
   \   000029   12....       LCALL     `??osal_msg_receive::?relay`; Banked call to: osal_msg_receive
   \   00002C   8A..         MOV       ?V0,R2
   \   00002E   8B..         MOV       ?V1,R3
   \   000030   E5..         MOV       A,?V0
   \   000032   45..         ORL       A,?V1
   \   000034   7003         JNZ       $+5
   \   000036   02....       LJMP      ??ProjectApp_ProcessEvent_4 & 0xFFFF
   \   000039   85..82       MOV       DPL,?V0
   \   00003C   85..83       MOV       DPH,?V1
   \   00003F   E0           MOVX      A,@DPTR
   \   000040   24E6         ADD       A,#-0x1a
   \   000042   7003         JNZ       $+5
   \   000044   02....       LJMP      ??ProjectApp_ProcessEvent_5 & 0xFFFF
   \   000047   245A         ADD       A,#0x5a
   \   000049   6057         JZ        ??ProjectApp_ProcessEvent_6
   \   00004B   24EF         ADD       A,#-0x11
   \   00004D   60C8         JZ        ??ProjectApp_ProcessEvent_2
   \   00004F   24FE         ADD       A,#-0x2
   \   000051   70CA         JNZ       ??ProjectApp_ProcessEvent_3
   \   000053   E5..         MOV       A,?V0
   \   000055   240C         ADD       A,#0xc
   \   000057   F582         MOV       DPL,A
   \   000059   E4           CLR       A
   \   00005A   35..         ADDC      A,?V1
   \   00005C   F583         MOV       DPH,A
   \   00005E   E0           MOVX      A,@DPTR
   \   00005F   6420         XRL       A,#0x20
   \   000061   7004         JNZ       ??ProjectApp_ProcessEvent_7
   \   000063   A3           INC       DPTR
   \   000064   E0           MOVX      A,@DPTR
   \   000065   6480         XRL       A,#0x80
   \                     ??ProjectApp_ProcessEvent_7:
   \   000067   70B4         JNZ       ??ProjectApp_ProcessEvent_3
   \   000069   E5..         MOV       A,?V0
   \   00006B   2413         ADD       A,#0x13
   \   00006D   F582         MOV       DPL,A
   \   00006F   E4           CLR       A
   \   000070   35..         ADDC      A,?V1
   \   000072   F583         MOV       DPH,A
   \   000074   E0           MOVX      A,@DPTR
   \   000075   F8           MOV       R0,A
   \   000076   A3           INC       DPTR
   \   000077   E0           MOVX      A,@DPTR
   \   000078   F583         MOV       DPH,A
   \   00007A   8882         MOV       DPL,R0
   \   00007C   E0           MOVX      A,@DPTR
   \   00007D   7019         JNZ       ??ProjectApp_ProcessEvent_8
   \   00007F                ; Setup parameters for call to function printf
   \   00007F   7A..         MOV       R2,#`?<Constant "Bind success!\\r\\n">` & 0xff
   \   000081   7B..         MOV       R3,#(`?<Constant "Bind success!\\r\\n">` >> 8) & 0xff
   \   000083   12....       LCALL     `??printf::?relay`; Banked call to: printf
   \   000086                ; Setup parameters for call to function osal_start_timerEx
   \   000086   7CE8         MOV       R4,#-0x18
   \   000088   7D03         MOV       R5,#0x3
   \   00008A   7A01         MOV       R2,#0x1
   \   00008C   7B00         MOV       R3,#0x0
   \   00008E   90....       MOV       DPTR,#ProjectApp_TaskID
   \   000091   E0           MOVX      A,@DPTR
   \   000092   F9           MOV       R1,A
   \   000093   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
   \   000096   8085         SJMP      ??ProjectApp_ProcessEvent_3
   \                     ??ProjectApp_ProcessEvent_8:
   \   000098                ; Setup parameters for call to function printf
   \   000098   7A..         MOV       R2,#`?<Constant "Bind failure!\\r\\n">` & 0xff
   \   00009A   7B..         MOV       R3,#(`?<Constant "Bind failure!\\r\\n">` >> 8) & 0xff
   \   00009C   12....       LCALL     `??printf::?relay`; Banked call to: printf
   \   00009F   02....       LJMP      ??ProjectApp_ProcessEvent_3 & 0xFFFF
   \                     ??ProjectApp_ProcessEvent_6:
   \   0000A2   A3           INC       DPTR
   \   0000A3   A3           INC       DPTR
   \   0000A4   A3           INC       DPTR
   \   0000A5   E0           MOVX      A,@DPTR
   \   0000A6   F5..         MOV       ?V4,A
   \   0000A8   A2E1         MOV       C,0xE0 /* A   */.1
   \   0000AA   5072         JNC       ??ProjectApp_ProcessEvent_9
   \   0000AC                ; Setup parameters for call to function HalLedSet
   \   0000AC   7A00         MOV       R2,#0x0
   \   0000AE   7908         MOV       R1,#0x8
   \   0000B0   12....       LCALL     `??HalLedSet::?relay`; Banked call to: HalLedSet
   \   0000B3   7408         MOV       A,#0x8
   \   0000B5   12....       LCALL     ?XSTACK_DISP0_8
   \   0000B8   7402         MOV       A,#0x2
   \   0000BA   F0           MOVX      @DPTR,A
   \   0000BB   85..82       MOV       DPL,?XSP + 0
   \   0000BE   85..83       MOV       DPH,?XSP + 1
   \   0000C1   E4           CLR       A
   \   0000C2   F0           MOVX      @DPTR,A
   \   0000C3   A3           INC       DPTR
   \   0000C4   F0           MOVX      @DPTR,A
   \   0000C5                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000C5   12....       LCALL     `??NLME_GetShortAddr::?relay`; Banked call to: NLME_GetShortAddr
   \   0000C8   8A..         MOV       ?V2,R2
   \   0000CA   8B..         MOV       ?V3,R3
   \   0000CC   AC..         MOV       R4,?V2
   \   0000CE   AD..         MOV       R5,?V3
   \   0000D0   75....       MOV       ?V6,#ProjectApp_ClusterList & 0xff
   \   0000D3   75....       MOV       ?V7,#(ProjectApp_ClusterList >> 8) & 0xff
   \   0000D6                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   0000D6   75..00       MOV       ?V2,#0x0
   \   0000D9   78..         MOV       R0,#?V2
   \   0000DB   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000DE   85....       MOV       ?V2,?V6
   \   0000E1   85....       MOV       ?V3,?V7
   \   0000E4   78..         MOV       R0,#?V2
   \   0000E6   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000E9   75..01       MOV       ?V2,#0x1
   \   0000EC   78..         MOV       R0,#?V2
   \   0000EE   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   0000F1   85....       MOV       ?V2,?V6
   \   0000F4   78..         MOV       R0,#?V2
   \   0000F6   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0000F9   75..01       MOV       ?V2,#0x1
   \   0000FC   78..         MOV       R0,#?V2
   \   0000FE   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000101   75..04       MOV       ?V2,#0x4
   \   000104   75..0F       MOV       ?V3,#0xf
   \   000107   78..         MOV       R0,#?V2
   \   000109   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00010C   90....       MOV       DPTR,#ProjectApp_epDesc
   \   00010F   E0           MOVX      A,@DPTR
   \   000110   F9           MOV       R1,A
   \   000111   7409         MOV       A,#0x9
   \   000113   12....       LCALL     ?XSTACK_DISP101_8
   \   000116   12....       LCALL     `??ZDP_EndDeviceBindReq::?relay`; Banked call to: ZDP_EndDeviceBindReq
   \   000119   7409         MOV       A,#0x9
   \   00011B   12....       LCALL     ?DEALLOC_XSTACK8
   \                     ??ProjectApp_ProcessEvent_9:
   \   00011E   E5..         MOV       A,?V4
   \   000120   A2E3         MOV       C,0xE0 /* A   */.3
   \   000122   4003         JC        $+5
   \   000124   02....       LJMP      ??ProjectApp_ProcessEvent_3 & 0xFFFF
   \   000127                ; Setup parameters for call to function HalLedSet
   \   000127   7A00         MOV       R2,#0x0
   \   000129   7908         MOV       R1,#0x8
   \   00012B   12....       LCALL     `??HalLedSet::?relay`; Banked call to: HalLedSet
   \   00012E   7408         MOV       A,#0x8
   \   000130   12....       LCALL     ?XSTACK_DISP0_8
   \   000133   740F         MOV       A,#0xf
   \   000135   F0           MOVX      @DPTR,A
   \   000136   85..82       MOV       DPL,?XSP + 0
   \   000139   85..83       MOV       DPH,?XSP + 1
   \   00013C   74FF         MOV       A,#-0x1
   \   00013E   F0           MOVX      @DPTR,A
   \   00013F   A3           INC       DPTR
   \   000140   F0           MOVX      @DPTR,A
   \   000141   75....       MOV       ?V6,#ProjectApp_ClusterList & 0xff
   \   000144   75....       MOV       ?V7,#(ProjectApp_ClusterList >> 8) & 0xff
   \   000147                ; Setup parameters for call to function ZDP_MatchDescReq
   \   000147   75..00       MOV       ?V2,#0x0
   \   00014A   78..         MOV       R0,#?V2
   \   00014C   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00014F   78..         MOV       R0,#?V6
   \   000151   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000154   75..01       MOV       ?V2,#0x1
   \   000157   78..         MOV       R0,#?V2
   \   000159   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   00015C   78..         MOV       R0,#?V6
   \   00015E   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000161   75..04       MOV       ?V2,#0x4
   \   000164   75..0F       MOV       ?V3,#0xf
   \   000167   78..         MOV       R0,#?V2
   \   000169   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00016C   7901         MOV       R1,#0x1
   \   00016E   7CFF         MOV       R4,#-0x1
   \   000170   7DFF         MOV       R5,#-0x1
   \   000172   7408         MOV       A,#0x8
   \   000174   12....       LCALL     ?XSTACK_DISP101_8
   \   000177   12....       LCALL     `??ZDP_MatchDescReq::?relay`; Banked call to: ZDP_MatchDescReq
   \   00017A   7408         MOV       A,#0x8
   \   00017C   12....       LCALL     ?DEALLOC_XSTACK8
   \   00017F   02....       LJMP      ??ProjectApp_ProcessEvent_3 & 0xFFFF
   \                     ??ProjectApp_ProcessEvent_5:
   \   000182   A3           INC       DPTR
   \   000183   A3           INC       DPTR
   \   000184   A3           INC       DPTR
   \   000185   A3           INC       DPTR
   \   000186   E0           MOVX      A,@DPTR
   \   000187   6401         XRL       A,#0x1
   \   000189   7002         JNZ       ??ProjectApp_ProcessEvent_10
   \   00018B   A3           INC       DPTR
   \   00018C   E0           MOVX      A,@DPTR
   \                     ??ProjectApp_ProcessEvent_10:
   \   00018D   6003         JZ        $+5
   \   00018F   02....       LJMP      ??ProjectApp_ProcessEvent_3 & 0xFFFF
   \   000192                ; Setup parameters for call to function printf
   \   000192   E5..         MOV       A,?V0
   \   000194   2422         ADD       A,#0x22
   \   000196   F582         MOV       DPL,A
   \   000198   E4           CLR       A
   \   000199   35..         ADDC      A,?V1
   \   00019B   F583         MOV       DPH,A
   \   00019D   12....       LCALL     ?PUSH_XSTACK8_X_TWO
   \   0001A0   7A..         MOV       R2,#`?<Constant "%s\\r\\n">` & 0xff
   \   0001A2   7B..         MOV       R3,#(`?<Constant "%s\\r\\n">` >> 8) & 0xff
   \   0001A4   12....       LCALL     `??printf::?relay`; Banked call to: printf
   \   0001A7   7402         MOV       A,#0x2
   \   0001A9   12....       LCALL     ?DEALLOC_XSTACK8
   \   0001AC   02....       LJMP      ??ProjectApp_ProcessEvent_3 & 0xFFFF
    253              }
    254          
    255              // return unprocessed events
    256              return (events ^ SYS_EVENT_MSG);
   \                     ??ProjectApp_ProcessEvent_4:
   \   0001AF   EE           MOV       A,R6
   \   0001B0   FA           MOV       R2,A
   \   0001B1   EF           MOV       A,R7
   \   0001B2   6480         XRL       A,#0x80
   \   0001B4   02....       LJMP      ??ProjectApp_ProcessEvent_11 & 0xFFFF
    257            }
    258          
    259            // Send a message out - This event is generated by a timer
    260            //  (setup in ProjectApp_Init()).
    261            if ( events & PROJECTAPP_SEND_MSG_EVT )
   \                     ??ProjectApp_ProcessEvent_0:
   \   0001B7   EA           MOV       A,R2
   \   0001B8   A2E0         MOV       C,0xE0 /* A   */.0
   \   0001BA   4003         JC        $+5
   \   0001BC   02....       LJMP      ??ProjectApp_ProcessEvent_12 & 0xFFFF
    262            {
    263              // Send "the" message
    264              ProjectApp_SendBindcast();
   \   0001BF                ; Setup parameters for call to function SHT2x_GetTempPoll
   \   0001BF   12....       LCALL     `??SHT2x_GetTempPoll::?relay`; Banked call to: SHT2x_GetTempPoll
   \   0001C2   8A..         MOV       ?V0,R2
   \   0001C4   8B..         MOV       ?V1,R3
   \   0001C6   8C..         MOV       ?V2,R4
   \   0001C8   8D..         MOV       ?V3,R5
   \   0001CA                ; Setup parameters for call to function sprintf
   \   0001CA   78..         MOV       R0,#?V0
   \   0001CC   12....       LCALL     ?PUSH_XSTACK_I_FOUR
   \   0001CF   7C..         MOV       R4,#`?<Constant "%5.2f C\\r\\n">` & 0xff
   \   0001D1   7D..         MOV       R5,#(`?<Constant "%5.2f C\\r\\n">` >> 8) & 0xff
   \   0001D3   7419         MOV       A,#0x19
   \   0001D5   12....       LCALL     ?XSTACK_DISP101_8
   \   0001D8   12....       LCALL     `??sprintf::?relay`; Banked call to: sprintf
   \   0001DB   7404         MOV       A,#0x4
   \   0001DD   12....       LCALL     ?DEALLOC_XSTACK8
   \   0001E0                ; Setup parameters for call to function printf
   \   0001E0   7415         MOV       A,#0x15
   \   0001E2   12....       LCALL     ?XSTACK_DISP100_8
   \   0001E5   88..         MOV       ?V0,R0
   \   0001E7   89..         MOV       ?V1,R1
   \   0001E9   78..         MOV       R0,#?V0
   \   0001EB   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   0001EE   7A..         MOV       R2,#`?<Constant "%s\\r\\n">` & 0xff
   \   0001F0   7B..         MOV       R3,#(`?<Constant "%s\\r\\n">` >> 8) & 0xff
   \   0001F2   12....       LCALL     `??printf::?relay`; Banked call to: printf
   \   0001F5   7402         MOV       A,#0x2
   \   0001F7   12....       LCALL     ?DEALLOC_XSTACK8
   \   0001FA   7411         MOV       A,#0x11
   \   0001FC   12....       LCALL     ?XSTACK_DISP0_8
   \   0001FF   E4           CLR       A
   \   000200   F0           MOVX      @DPTR,A
   \   000201   7412         MOV       A,#0x12
   \   000203   12....       LCALL     ?XSTACK_DISP0_8
   \   000206   E4           CLR       A
   \   000207   F0           MOVX      @DPTR,A
   \   000208   7409         MOV       A,#0x9
   \   00020A   12....       LCALL     ?XSTACK_DISP0_8
   \   00020D   E4           CLR       A
   \   00020E   F0           MOVX      @DPTR,A
   \   00020F   A3           INC       DPTR
   \   000210   F0           MOVX      @DPTR,A
   \   000211                ; Setup parameters for call to function strlen
   \   000211   7415         MOV       A,#0x15
   \   000213   12....       LCALL     ?XSTACK_DISP101_8
   \   000216   12....       LCALL     `??strlen::?relay`; Banked call to: strlen
   \   000219                ; Setup parameters for call to function AF_DataRequest
   \   000219   75..1E       MOV       ?V0,#0x1e
   \   00021C   78..         MOV       R0,#?V0
   \   00021E   12....       LCALL     ?PUSH_XSTACK_I_ONE
   \   000221   75....       MOV       ?V0,#ProjectApp_TransID & 0xff
   \   000224   75....       MOV       ?V1,#(ProjectApp_TransID >> 8) & 0xff
   \   000227   78..         MOV       R0,#?V0
   \   000229   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00022C   7418         MOV       A,#0x18
   \   00022E   12....       LCALL     ?XSTACK_DISP100_8
   \   000231   88..         MOV       ?V0,R0
   \   000233   89..         MOV       ?V1,R1
   \   000235   78..         MOV       R0,#?V0
   \   000237   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   00023A   EA           MOV       A,R2
   \   00023B   2401         ADD       A,#0x1
   \   00023D   F5..         MOV       ?V0,A
   \   00023F   E4           CLR       A
   \   000240   3B           ADDC      A,R3
   \   000241   F5..         MOV       ?V1,A
   \   000243   78..         MOV       R0,#?V0
   \   000245   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000248   75..01       MOV       ?V0,#0x1
   \   00024B   75..00       MOV       ?V1,#0x0
   \   00024E   78..         MOV       R0,#?V0
   \   000250   12....       LCALL     ?PUSH_XSTACK_I_TWO
   \   000253   7920         MOV       R1,#0x20
   \   000255   7C..         MOV       R4,#ProjectApp_epDesc & 0xff
   \   000257   7D..         MOV       R5,#(ProjectApp_epDesc >> 8) & 0xff
   \   000259   7412         MOV       A,#0x12
   \   00025B   12....       LCALL     ?XSTACK_DISP101_8
   \   00025E   12....       LCALL     `??AF_DataRequest::?relay`; Banked call to: AF_DataRequest
   \   000261   7409         MOV       A,#0x9
   \   000263   12....       LCALL     ?DEALLOC_XSTACK8
    265          
    266          //ProjectApp_SendTheMessage();
    267          // Setup to send message again
    268           
    269              osal_start_timerEx( ProjectApp_TaskID,
    270                                  PROJECTAPP_SEND_MSG_EVT,
    271                                  PROJECTAPP_SEND_MSG_TIMEOUT+(osal_rand() & 0x00FF));
   \   000266                ; Setup parameters for call to function osal_rand
   \   000266   12....       LCALL     `??osal_rand::?relay`; Banked call to: osal_rand
   \   000269                ; Setup parameters for call to function osal_start_timerEx
   \   000269   EA           MOV       A,R2
   \   00026A   24E8         ADD       A,#-0x18
   \   00026C   FC           MOV       R4,A
   \   00026D   E4           CLR       A
   \   00026E   3403         ADDC      A,#0x3
   \   000270   FD           MOV       R5,A
   \   000271   7A01         MOV       R2,#0x1
   \   000273   7B00         MOV       R3,#0x0
   \   000275   90....       MOV       DPTR,#ProjectApp_TaskID
   \   000278   E0           MOVX      A,@DPTR
   \   000279   F9           MOV       R1,A
   \   00027A   12....       LCALL     `??osal_start_timerEx::?relay`; Banked call to: osal_start_timerEx
    272          
    273              // return unprocessed events
    274              return (events ^ PROJECTAPP_SEND_MSG_EVT);
   \   00027D   EE           MOV       A,R6
   \   00027E   6401         XRL       A,#0x1
   \   000280   FA           MOV       R2,A
   \   000281   EF           MOV       A,R7
   \                     ??ProjectApp_ProcessEvent_11:
   \   000282   FB           MOV       R3,A
   \   000283   8004         SJMP      ??ProjectApp_ProcessEvent_13
    275            }
    276          
    277            
    278          #if defined( IAR_ARMCM3_LM )
    279            // Receive a message from the RTOS queue
    280            if ( events & PROJECTAPP_RTOS_MSG_EVT )
    281            {
    282              // Process message from RTOS queue
    283              ProjectApp_ProcessRtosMessage();
    284          
    285              // return unprocessed events
    286              return (events ^ PROJECTAPP_RTOS_MSG_EVT);
    287            }
    288          #endif
    289          
    290            // Discard unknown events
    291            return 0;
   \                     ??ProjectApp_ProcessEvent_12:
   \   000285   7A00         MOV       R2,#0x0
   \   000287   7B00         MOV       R3,#0x0
   \                     ??ProjectApp_ProcessEvent_13:
   \   000289   7435         MOV       A,#0x35
   \   00028B   12....       LCALL     ?DEALLOC_XSTACK8
   \   00028E   7F08         MOV       R7,#0x8
   \   000290   02....       LJMP      ?BANKED_LEAVE_XDATA
    292          }

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Bind success!\\r\\n">`:
   \   000000   42696E64     DB "Bind success!\015\012"
   \            20737563
   \            63657373
   \            210D0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Bind failure!\\r\\n">`:
   \   000000   42696E64     DB "Bind failure!\015\012"
   \            20666169
   \            6C757265
   \            210D0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "%5.2f C\\r\\n">`:
   \   000000   25352E32     DB "%5.2f C\015\012"
   \            6620430D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "%s\\r\\n">`:
   \   000000   25730D0A     DB "%s\015\012"
   \            00      
    293          
    294          
    295          /*********************************************************************
    296           * @fn      ProjectApp_HandleKeys
    297           *
    298           * @brief   Handles all key events for this device.
    299           *
    300           * @param   shift - true if in shift/alt.
    301           * @param   keys - bit field for key events. Valid entries:
    302           *                 HAL_KEY_SW_4
    303           *                 HAL_KEY_SW_3
    304           *                 HAL_KEY_SW_2
    305           *                 HAL_KEY_SW_1
    306           *
    307           * @return  none
    308           */
    309          static void ProjectApp_HandleKeys( uint8 shift, uint8 keys )
    310          {
    311            zAddrType_t dstAddr;
    312          
    313            // Shift is used to make each button/switch dual purpose.
    314            if ( shift )
    315            {
    316              if ( keys & HAL_KEY_SW_1 )
    317              {
    318              }
    319              if ( keys & HAL_KEY_SW_2 )
    320              {
    321              }
    322              if ( keys & HAL_KEY_SW_3 )
    323              {
    324              }
    325              if ( keys & HAL_KEY_SW_4 )
    326              {
    327              }
    328            }
    329            else
    330            {
    331              if ( keys & HAL_KEY_SW_1 )
    332              {
    333              }
    334          
    335          #if defined( SWITCH1_BIND )
    336                // we can use SW1 to simulate SW2 for devices that only have one switch,
    337                keys |= HAL_KEY_SW_2;
    338          #elif defined( SWITCH1_MATCH )
    339                // or use SW1 to simulate SW4 for devices that only have one switch
    340                keys |= HAL_KEY_SW_4;
    341          #endif
    342              }
    343          
    344              if ( keys & HAL_KEY_SW_2 )
    345              {
    346                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    347          
    348                // Initiate an End Device Bind Request for the mandatory endpoint
    349                dstAddr.addrMode = Addr16Bit;
    350                dstAddr.addr.shortAddr = 0x0000; // Coordinator
    351                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    352                                      ProjectApp_epDesc.endPoint,
    353                                      PROJECTAPP_PROFID,
    354                                      PROJECTAPP_MAX_CLUSTERS, (cId_t *)ProjectApp_ClusterList,
    355                                      PROJECTAPP_MAX_CLUSTERS, (cId_t *)ProjectApp_ClusterList,
    356                                      FALSE );
    357              }
    358          
    359              if ( keys & HAL_KEY_SW_3 )
    360              {
    361              }
    362          
    363              if ( keys & HAL_KEY_SW_4 )
    364              {
    365                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    366                // Initiate a Match Description Request (Service Discovery)
    367                dstAddr.addrMode = AddrBroadcast;
    368                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    369                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    370                                  PROJECTAPP_PROFID,
    371                                  PROJECTAPP_MAX_CLUSTERS, (cId_t *)ProjectApp_ClusterList,
    372                                  PROJECTAPP_MAX_CLUSTERS, (cId_t *)ProjectApp_ClusterList,
    373                                  FALSE );
    374              }
    375            }
    376          
    377          
    378          static void ProjectApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )//
    379          {
    380            switch ( inMsg->clusterID )
    381            {
    382              case End_Device_Bind_rsp:
    383                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    384                {
    385                  printf("Bind success!\r\n");
    386                  osal_start_timerEx( ProjectApp_TaskID,
    387                                      PROJECTAPP_SEND_MSG_EVT,
    388                                      PROJECTAPP_SEND_MSG_TIMEOUT );
    389                }
    390                else
    391                {
    392                  printf("Bind failure!\r\n");
    393                }
    394                break;
    395            }
    396          }
    397          
    398          
    399          
    400          
    401          static void ProjectApp_SendBindcast( void )
    402          {
    403            float temp = SHT2x_GetTempPoll();
    404            char Str_Buf[32];
    405            sprintf(Str_Buf, "%5.2f C\r\n", temp);
    406            printf("%s\r\n",Str_Buf);
    407          
    408            afAddrType_t ProjectApp_DstAddr;
    409            ProjectApp_DstAddr.addrMode       = (afAddrMode_t)AddrNotPresent;
    410            ProjectApp_DstAddr.endPoint       = 0;
    411            ProjectApp_DstAddr.addr.shortAddr = 0;
    412            
    413            AF_DataRequest( &ProjectApp_DstAddr,
    414                            &ProjectApp_epDesc,
    415                            PROJECTAPP_CLUSTERID,
    416                            strlen(Str_Buf)+1,
    417                            (uint8 *)Str_Buf,
    418                            &ProjectApp_TransID,
    419                            AF_DISCV_ROUTE,
    420                            AF_DEFAULT_RADIUS
    421                          );
    422          }
    423          /*********************************************************************
    424           * LOCAL FUNCTIONS
    425           */
    426          
    427          /*********************************************************************
    428           * @fn      ProjectApp_MessageMSGCB
    429           *
    430           * @brief   Data message processor callback.  This function processes
    431           *          any incoming data - probably from other devices.  So, based
    432           *          on cluster ID, perform the intended action.
    433           *
    434           * @param   none
    435           *
    436           * @return  none
    437           */
    438          static void ProjectApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
    439          {
    440            switch ( pkt->clusterId )
    441            {
    442              case PROJECTAPP_CLUSTERID:
    443                printf("%s\r\n", pkt->cmd.Data);
    444                break;
    445            }
    446          }
    447          
    448          /*********************************************************************
    449           * @fn      ProjectApp_SendTheMessage
    450           *
    451           * @brief   Send "the" message.
    452           *
    453           * @param   none
    454           *
    455           * @return  none
    456           */
    457          
    458          
    459          //static void ProjectApp_SendTheMessage( void )
    460          //{
    461          //  char strTemp[3];//
    462          //  DHT11(); 
    463          //
    464          //  strTemp[0] = wendu_shi+0x30;
    465          //  strTemp[1] = wendu_ge+0x30;
    466          //  strTemp[2] = '\0';
    467          //  
    468          //  afAddrType_t dstAddr;
    469          //  dstAddr.endPoint = PROJECTAPP_ENDPOINT;//
    470          //  dstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    471          //  dstAddr.addr.shortAddr = 0x0000; // Coordinator
    472          //
    473          //  AF_DataRequest( &dstAddr,
    474          //                  &ProjectApp_epDesc,// 
    475          //                  PROJECTAPP_CLUSTERID,
    476          //                  strlen(strTemp)+1,//'\0'
    477          //                  (uint8 *)strTemp,//
    478          //                  &ProjectApp_TransID,
    479          //                  AF_DISCV_ROUTE,
    480          //                  AF_DEFAULT_RADIUS );
    481          //}
    482          
    483          #if defined( IAR_ARMCM3_LM )
    484          /*********************************************************************
    485           * @fn      ProjectApp_ProcessRtosMessage
    486           *
    487           * @brief   Receive message from RTOS queue, send response back.
    488           *
    489           * @param   none
    490           *
    491           * @return  none
    492           */
    493          static void ProjectApp_ProcessRtosMessage( void )
    494          {
    495            osalQueue_t inMsg;
    496          
    497            if ( osal_queue_receive( OsalQueue, &inMsg, 0 ) == pdPASS )
    498            {
    499              uint8 cmndId = inMsg.cmnd;
    500              uint32 counter = osal_build_uint32( inMsg.cbuf, 4 );
    501          
    502              switch ( cmndId )
    503              {
    504                case CMD_INCR:
    505                  counter += 1;  /* Increment the incoming counter */
    506                                 /* Intentionally fall through next case */
    507          
    508                case CMD_ECHO:
    509                {
    510                  userQueue_t outMsg;
    511          
    512                  outMsg.resp = RSP_CODE | cmndId;  /* Response ID */
    513                  osal_buffer_uint32( outMsg.rbuf, counter );    /* Increment counter */
    514                  osal_queue_send( UserQueue1, &outMsg, 0 );  /* Send back to UserTask */
    515                  break;
    516                }
    517                
    518                default:
    519                  break;  /* Ignore unknown command */    
    520              }
    521            }
    522          }
    523          #endif
    524          
    525          /*********************************************************************
    526           */

   Maximum stack usage in bytes:

   XSTACK Function
   ------ --------
      9   ProjectApp_Init
        9   -> RegisterForKeys
        9   -> SHT2x_Init
        9   -> USER_Uart0_Init
        9   -> ZDO_RegisterForZDOMsg
        9   -> afRegister
     78   ProjectApp_ProcessEvent
       78   -> AF_DataRequest
       69   -> HalLedSet
       69   -> NLME_GetShortAddr
       69   -> SHT2x_GetTempPoll
       78   -> ZDP_EndDeviceBindReq
       77   -> ZDP_MatchDescReq
       69   -> osal_msg_deallocate
       69   -> osal_msg_receive
       69   -> osal_rand
       69   -> osal_start_timerEx
       69   -> printf
       71   -> printf
       73   -> sprintf
       69   -> strlen
       69   -> user_state_change


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      10  ?<Constant "%5.2f C\r\n">
       5  ?<Constant "%s\r\n">
      16  ?<Constant "Bind failure!\r\n">
      16  ?<Constant "Bind success!\r\n">
      11  ??Subroutine1_0
       2  ?Subroutine0
       2  ProjectApp_ClusterList
      12  ProjectApp_DstAddr
      97  ProjectApp_Init
       1  ProjectApp_NwkState
     659  ProjectApp_ProcessEvent
      12  ProjectApp_SimpleDesc
       1  ProjectApp_TaskID
       1  ProjectApp_TransID
       6  ProjectApp_epDesc
      12  -- Other

 
 769 bytes in segment BANKED_CODE
  12 bytes in segment BANK_RELAYS
  61 bytes in segment XDATA_ROM_C
  21 bytes in segment XDATA_Z
 
  12 bytes of CODE     memory
  61 bytes of CONST    memory
 769 bytes of HUGECODE memory
  21 bytes of XDATA    memory

Errors: none
Warnings: none
